name: Deploy

on:
    release:
        types:
          - published

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@master
          - name: Version
            run: echo ::set-env name=VERSION::${GITHUB_REF:10}
          - name: .NET Core
            uses: actions/setup-dotnet@v1
            with:
                dotnet-version: '3.1.102'
          - name: Build
            run: dotnet build -c Release -p:PackageVersion=${{ env.RELEASE_VERSION }} Web/Diov.Web.csproj
          - name: Publish
            run: dotnet publish -c Release --no-build -o ./app -p:PackageVersion=${{ env.RELEASE_VERSION }} Web/Diov.Web.csproj
          - name: Deploy
            uses: azure/webapps-deploy@v2
            with:
                app-name: null-d3v
                publish-profile: ${{ secrets.AzureAppService_PublishProfile_507f97ff270548f098acfcdc3a8bd15f }}
                package: ./app
